<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: dom/videoPlay.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: dom/videoPlay.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * @Author: zhangyu
 * @Email: zhangdulin@outlook.com
 * @Date: 2021-06-11 14:27:40
 * @LastEditors: zhangyu
 * @LastEditTime: 2021-06-15 10:48:26
 * @Description: 
 */

// chrom浏览器禁止自动播放 video标签添加muted属性静音可以自动：
// android h5 webview
// android 4.2 webview添加了是否需要用户手势去触发音视频的播放开关，默认为true(需要用户手势触发)。
// 将webview的这个开关设置为不需要用户触发：
// mWebview.getSettings().setMediaPlaybackRequiresUserGesture(false);
// IOS h5 webview
// IOS APP给webview设置mediaPlaybackRequiresUserAction后可以允许自动播放.
/**
 * @description: 设置video 自动播放 
 * @param {*} id video的dom的id
 * @return {*}
 */
export function setVideoPlay(id) {  
    /**video.play()返回一个promise，未禁止则resolve，禁止则reject**/
    let video = document.getElementById(id);
    video.addEventListener('ended', () => { //结束
      console.log("播放结束")
      // this.$bridgePromise.closeWebView()
    }, false);
    video.muted = false; // 设置有音
    let videoPlay = video.play();
 
    // document.body.addEventListener('mousedown', function () {
    //   video.muted = false;
    // }, false);
 
    videoPlay.then(() => {
      console.log('可以自动播放');
    }).catch((err) => {
      console.log(err);
      console.log("不允许自动播放");
 
      //视频元素可以选择静音后再播放,提示用户打开声音
      video.muted = true;
      // video.play();
 
      video.onloadedmetadata = function () {
        video.muted = false;
        video.play()
      }
      video.load() // 重新
    })
      //也可以在用户交互后调用.play()
      // ...
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#callHandler">callHandler</a></li><li><a href="global.html#dateFormat1">dateFormat1</a></li><li><a href="global.html#dateFormat2">dateFormat2</a></li><li><a href="global.html#debounce">debounce</a></li><li><a href="global.html#elDateFormat">elDateFormat</a></li><li><a href="global.html#exportXls">exportXls</a></li><li><a href="global.html#getBrowserModel">getBrowserModel</a></li><li><a href="global.html#getDefaultAvatar">getDefaultAvatar</a></li><li><a href="global.html#getDeviceModel">getDeviceModel</a></li><li><a href="global.html#getImgBase64">getImgBase64</a></li><li><a href="global.html#getThumbnails">getThumbnails</a></li><li><a href="global.html#handleEmoji">handleEmoji</a></li><li><a href="global.html#handleParam">handleParam</a></li><li><a href="global.html#handleText">handleText</a></li><li><a href="global.html#isArray">isArray</a></li><li><a href="global.html#isEmoji">isEmoji</a></li><li><a href="global.html#isIDCard">isIDCard</a></li><li><a href="global.html#isMobile">isMobile</a></li><li><a href="global.html#isObject">isObject</a></li><li><a href="global.html#isSpecialChar">isSpecialChar</a></li><li><a href="global.html#parseTime">parseTime</a></li><li><a href="global.html#setVideoPlay">setVideoPlay</a></li><li><a href="global.html#throttle">throttle</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Thu Jun 17 2021 13:34:59 GMT+0800 (GMT+08:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
